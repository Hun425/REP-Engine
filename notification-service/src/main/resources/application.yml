spring:
  application:
    name: notification-service

  # Kafka
  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
    consumer:
      group-id: notification-consumer-group
      properties:
        schema.registry.url: ${SCHEMA_REGISTRY_URL:http://localhost:8081}
    producer:
      properties:
        schema.registry.url: ${SCHEMA_REGISTRY_URL:http://localhost:8081}

  # Elasticsearch
  elasticsearch:
    uris: ${ELASTICSEARCH_URIS:http://localhost:9200}

  # Redis
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}

# Notification Service Settings
notification:
  # 가격 하락 알림 임계값 (%) - 이 비율 이상 하락 시 알림
  price-drop-threshold: ${PRICE_DROP_THRESHOLD:10}

  # 알림 대상 유저 조회 설정
  target-user-limit: ${TARGET_USER_LIMIT:10000}
  interested-user-days: ${INTERESTED_USER_DAYS:30}
  cart-user-days: ${CART_USER_DAYS:7}

  # Rate Limiting
  daily-limit-per-user: ${DAILY_LIMIT_PER_USER:10}
  duplicate-prevention-hours: ${DUPLICATE_PREVENTION_HOURS:1}

  # Kafka Topics
  inventory-topic: ${INVENTORY_TOPIC:product.inventory.v1}
  notification-topic: ${NOTIFICATION_TOPIC:notification.push.v1}

  # 배치 처리 설정 (Kafka 버스트 방지)
  batch-size: ${NOTIFICATION_BATCH_SIZE:100}
  batch-delay-ms: ${NOTIFICATION_BATCH_DELAY_MS:50}

  # 추천 알림 배치 설정 (ShedLock + @Scheduled)
  recommendation:
    enabled: ${RECOMMENDATION_ENABLED:true}
    cron: ${RECOMMENDATION_CRON:0 0 9 * * *}
    active-user-days: ${RECOMMENDATION_ACTIVE_USER_DAYS:7}
    limit: ${RECOMMENDATION_LIMIT:3}
    # 로컬 개발: localhost:8082
    # Docker 환경: docker 프로파일에서 recommendation-api:8082로 오버라이드 (아래 참조)
    api-url: ${RECOMMENDATION_API_URL:http://localhost:8082}

  # DLQ (Dead Letter Queue) 설정
  dlq:
    enabled: ${DLQ_ENABLED:true}
    topic-suffix: ${DLQ_TOPIC_SUFFIX:.dlq}
    max-retries: ${DLQ_MAX_RETRIES:3}
    retry-backoff-ms: ${DLQ_RETRY_BACKOFF_MS:1000}

# Actuator
management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus,metrics
  endpoint:
    health:
      show-details: always
  metrics:
    tags:
      application: ${spring.application.name}
  # Tracing (Phase 5) - 로컬에서는 비활성화
  tracing:
    enabled: false

# Logging
logging:
  level:
    com.rep.notification: ${LOG_LEVEL:INFO}
    org.apache.kafka: WARN
    org.elasticsearch: WARN

# Server
server:
  port: ${SERVER_PORT:8083}

---
spring:
  config:
    activate:
      on-profile: docker

  kafka:
    bootstrap-servers: kafka:29092
    consumer:
      properties:
        schema.registry.url: http://schema-registry:8081
    producer:
      properties:
        schema.registry.url: http://schema-registry:8081

  elasticsearch:
    uris: http://elasticsearch:9200

  data:
    redis:
      host: redis
      port: 6379

# 추천 알림 API URL (Docker 네트워크)
notification:
  recommendation:
    api-url: http://recommendation-api:8082

# Tracing (Phase 5) - Docker 환경에서 활성화
management:
  tracing:
    enabled: true
    sampling:
      probability: 1.0  # 100% 샘플링 (개발용)
  otlp:
    tracing:
      endpoint: http://jaeger:4318/v1/traces
